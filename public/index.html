<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIGEF</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        .navbar {
            margin-bottom: 20px;
        }

        .wizard {
            max-width: 900px;
            margin: 20px auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
        }

        .progress-bar {
            height: 6px;
            background-color: #d3d3d3;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-bar-fill {
            height: 100%;
            width: 0;
            background-color: #6c63ff;
            transition: width 0.4s ease;
        }

        #finalForm {
            display: none;
            text-align: center;
            margin-top: 20px;
        }

        .success-container {
            background-color: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 400px;
            margin: auto;
        }

        .success-icon {
            color: #4CAF50;
            font-size: 50px;
            margin-bottom: 15px;
        }

        .success-message {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .success-text {
            font-size: 16px;
            margin-bottom: 20px;
            color: #555;
        }

        .success-button {
            padding: 10px 20px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            font-size: 16px;
        }

        .success-button:hover {
            background-color: #357ae8;
        }

        .navbar-text h4 {
            color: black;
        }

        .icon {
            font-size: 50px;
            color: green;
        }

        /* Upload  */

        .upload-container {
            border: 1px dashed #d1d5db;
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            margin: 20px auto;
            max-width: 500px;
            background-color: #f8f9fa;
        }

        .drag-area {
            border: 2px dashed #6c757d;
            padding: 30px;
            border-radius: 5px;
            color: #6c757d;
            margin: 10px 0;
            background-color: #e9ecef;
            cursor: pointer;
        }

        .drag-area:hover {
            background-color: #f1f3f5;
        }

        .progress-upload {
            height: 20px;
            margin-top: 10px;
        }

          .progress-bar-upload {
            background-color: #cad2dd;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 20px;
        }


        .thumbnail {
            max-width: 150px;
            margin-top: 10px;
        }

        .file-icon {
            font-size: 48px;
            color: #d9534f;
        }

        .download-link {
            margin-top: 10px;
            display: block;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="static/logo.png" height="60" alt="Logo" class="d-inline-block align-top">
            </a>
            <div class="mx-auto text-center">
                <span class="navbar-text h4">Dirección General de Educación Física Orientación Metodologíca (DIGEF2)</span>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="wizard  mx-auto col-10" id="wizardContainer">
            <form id="wizardForm" enctype="multipart/form-data">
                <input type="hidden" id="uuid" name="uuid">
                <div class="progress-bar">
                    <div class="progress-bar-fill" id="progressFill"></div>
                </div>

                <!-- Step containers -->
                <div class="step active" id="step1">
                    <h3>Paso 1: Información del Director</h3>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label>Nombre del Director:</label>
                            <input type="text" name="nombreDirector" class="form-control" value="">
                        </div>
                        <div class="col-md-6">
                            <label>Dirección del Director:</label>
                            <input type="text" name="direccionDirector" class="form-control">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label>Municipio:</label>
                            <input type="text" name="municipio" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label>Departamento:</label>
                            <input type="text" name="departamento" class="form-control">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label>Teléfono:</label>
                            <input type="text" name="telefono" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label>Correo Electrónico:</label>
                            <input type="email" name="correoElectronico" class="form-control">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label>Fecha de Nacimiento:</label>
                            <input type="date" name="fechaNacimiento" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label>Género:</label>
                            <select name="genero" class="form-control">
                                <option value="Masculino">Masculino</option>
                                <option value="Femenino">Femenino</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label>Título Académico:</label>
                            <input type="text" name="tituloAcademico" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label>Nivel Académico:</label>
                            <input type="text" name="nivelAcademico" class="form-control">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label>Renglón Presupuestario:</label>
                            <input type="text" name="renglonPresupuestario" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label>Escalafón:</label>
                            <input type="text" name="escalafon" class="form-control">
                        </div>
                    </div>
                </div>

                <div class="step" id="step2">

                    <h3 class="mb-4">Paso 2: Información del Establecimiento</h3>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="nombreEstablecimiento" class="form-label">Nombre del Establecimiento</label>
                            <input type="number" max="5" maxlength="5" class="form-control" id="nombreEstablecimiento"
                                placeholder="Ingrese el nombre">
                        </div>
                        <div class="col-md-6">
                            <label for="direccionEstablecimiento" class="form-label">Dirección</label>
                            <input type="text" class="form-control" id="direccionEstablecimiento"
                                placeholder="Ingrese la dirección">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="municipio" class="form-label">Municipio</label>
                            <input type="text" class="form-control" id="municipio" placeholder="Ingrese el municipio">
                        </div>
                        <div class="col-md-6">
                            <label for="departamento" class="form-label">Departamento</label>
                            <input type="text" class="form-control" id="departamento"
                                placeholder="Ingrese el departamento">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="telefono" class="form-label">Teléfono</label>
                            <input type="text" class="form-control" id="telefono"
                                placeholder="Ingrese el número de teléfono">
                        </div>
                        <div class="col-md-6">
                            <label for="email" class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="email" placeholder="ejemplo@dominio.com">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="nivelEscolar" class="form-label">Nivel Escolar</label>
                            <input type="text" class="form-control" id="nivelEscolar"
                                placeholder="Ingrese el nivel escolar">
                        </div>
                        <div class="col-md-6">
                            <label for="codigoEstablecimiento" class="form-label">Código del Establecimiento</label>
                            <input type="text" class="form-control" id="codigoEstablecimiento"
                                placeholder="Ingrese el código">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="jornada" class="form-label">Jornada</label>
                            <input type="text" class="form-control" id="jornada" placeholder="Ingrese la jornada">
                        </div>
                        <div class="col-md-6">
                            <label for="sector" class="form-label">Sector</label>
                            <input type="text" class="form-control" id="sector" placeholder="Ingrese el sector">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="alumnosFemenino" class="form-label">Alumnos Femenino</label>
                            <input type="number" class="form-control" id="alumnosFemenino" placeholder="Cantidad">
                        </div>
                        <div class="col-md-6">
                            <label for="alumnosMasculino" class="form-label">Alumnos Masculino</label>
                            <input type="number" class="form-control" id="alumnosMasculino" placeholder="Cantidad">
                        </div>
                    </div>
                </div>

                <div class="step" id="step3">
                    <h3>Información de Pago</h3>
                    <div class="upload-container">
                        <button id="sendButton" class="btn btn-secondary mb-3">Descargar Formato</button>

                        <div class="drag-area" id="dragArea">Arrastra y suelta archivos, o haz clic para seleccionar
                        </div>
                        <input type="file" class="form-control" id="fileInput" style="display: none;">
                        <div id="filePreview" class="mt-3"></div>
                        <button type="button" id="btnUpload" class="btn btn-primary mb-3">Subir</button>
                        <div class="progress-upload mt-3" id="progressBarContainer" style="display: none;">
                            <div class="progress-bar-upload" role="progressbar" style="width: 0%;" id="progressBar"></div>
                        </div>
                        <div id="statusMessage" class="mt-2 text-muted">Son evidencias, si la tienes a mano de lo que
                            necesitas, te apoyemos.</div>
                    </div>
                </div>

                <div class="step" id="step4">
                    <h3>Confirmación</h3>
                    <p>Revisa y confirma la información ingresada.</p>
                </div>

                <div class="d-flex justify-content-between mt-3" id="buttonContainer">
                    <button type="button" class="btn btn-secondary" onclick="prevStep()">Anterior</button>
                    <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextStep()">Siguiente</button>
                </div>

            </form>
        </div>

        <div id="finalForm">
            <div class="success-container">

                <div class="icon"><i class="fa fa-check-circle"></i></div>
                <div class="success-message">"¡Gracias!</div>
                <div class="success-text">Tu información ha sido recibida correctamente.</div>
                <a href="/" class="success-button">Vuelve a intentarlo</a>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 4;

        function updateProgressBar() {
            const progressFill = document.getElementById('progressFill');
            const progress = (currentStep / totalSteps) * 100;
            progressFill.style.width = progress + '%';
        }

        function cacheFormData() {
            const fields = document.querySelectorAll('.step.active input');
            fields.forEach(field => {
                localStorage.setItem(field.name, field.value);
            });
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                currentStep++;
                updateProgressBar();
                showStep(currentStep);
            } else if (currentStep === totalSteps) {
                finalizarProceso();
                showFinalMessage();
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateProgressBar();
                showStep(currentStep);
            }
        }

        function finalizarProceso() {
            //alert("Datos enviados: " + JSON.stringify(localStorage));
            alert("Datos enviados de prueba.")
        }

        function showStep(step) {
            const steps = document.querySelectorAll('.step');
            steps.forEach((el, index) => {
                el.classList.toggle('active', index + 1 === step);
            });
        }

        function showFinalMessage() {
            document.getElementById('wizardContainer').style.display = 'none';
            document.getElementById('finalForm').style.display = 'block';
        }

        updateProgressBar();
        showStep(currentStep);

        /*  */

        document.getElementById("sendButton").addEventListener("click", async function (event) {
            event.preventDefault();
            try {
                const response = await fetch("http://localhost:3000/api/pdf/director", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Accept": "application/pdf"
                    },
                    body: JSON.stringify({
                        name: "Juan Pérez",
                        address: "Calle 123",
                        municipio: "Guatemala",
                        departamento: "Guatemala",
                        telefono: "12345678",
                        email: "juan.perez@correo.com",
                        birthDate: "1980-01-01",
                        dpi: "1234567890101",
                        genero: "Masculino",
                        titulo: "Licenciado en Administración",
                        nivel: "Universitario",
                        renglon: "011",
                        escalafon: "A"
                    })
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement("a");
                    a.href = url;
                    a.download = "documento.pdf";
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                } else {
                    alert("Error al enviar la solicitud: " + response.status);
                }
            } catch (error) {
                alert("Error de red: " + error.message);
            }
        });


        /* Upload */

        const dragArea = document.getElementById('dragArea');
        const fileInput = document.getElementById('fileInput');
        const filePreview = document.getElementById('filePreview');

        dragArea.addEventListener('click', () => fileInput.click());

        dragArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dragArea.classList.add('bg-light');
        });

        dragArea.addEventListener('dragleave', () => {
            dragArea.classList.remove('bg-light');
        });

        dragArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dragArea.classList.remove('bg-light');
            fileInput.files = e.dataTransfer.files;
            displayPreview(fileInput.files[0]);
        });

        fileInput.addEventListener('change', () => {
            displayPreview(fileInput.files[0]);
        });

        function displayPreview(file) {
            if (file) {
                if (file.type === "application/pdf") {
                    filePreview.innerHTML = `<i class="fa-solid fa-file-pdf file-icon"></i> <p>${file.name}</p>`;
                } else {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        filePreview.innerHTML = `<img src="${e.target.result}" class="thumbnail"> <p>${file.name}</p>`;
                    }
                    reader.readAsDataURL(file);
                }
            }
        }

        document.getElementById("btnUpload").addEventListener("click", uploadFile);

        function uploadFile(event) {
            event.preventDefault();
            const progressBar = document.getElementById('progressBar');
            const progressBarContainer = document.getElementById('progressBarContainer');
            const statusMessage = document.getElementById('statusMessage');

            if (fileInput.files.length === 0) {
                alert('Por favor selecciona un archivo.');
                return;
            }

            progressBarContainer.style.display = 'block';
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                progressBar.style.width = progress + '%';
                progressBar.innerText = progress + '%';
                if (progress >= 100) {
                    clearInterval(interval);
                    statusMessage.textContent = 'Archivo subido correctamente.';
                }
            }, 100);
        }

    </script>
</body>

</html>